# ARTIFACTS

mutation createArtifact($organizationId: ID!, $artifactName: String!, $artifactType: String!, $artifactPayload: JSON!) {
  createArtifact(
    organizationId: $organizationId,
    name: $artifactName,
    type: $artifactType,
    payload: $artifactPayload
  ) {
    result {
      name
      id
    }
    successful
    # @genqlient(typename: "MutationValidationError")
    messages {
      message
    }
  }
}

query getArtifactsByType($organizationId: ID!, $artifactType: String!) {
  artifacts(organizationId: $organizationId, input: {filter: {type: $artifactType}}) {
    items {
      id
      name
      type
      updatedAt
    }
  }
}

query listCredentials($organizationId: ID!) {
  artifacts(organizationId: $organizationId, input: {filter: {credential: true}}) {
    items {
      id
      name
      type
      updatedAt
    }
  }
}

query downloadArtifact($organizationId: ID!, $artifactId: ID!, $format: String!) {
  downloadArtifact(organizationId: $organizationId, artifactId: $artifactId, format: $format) {
    renderedArtifact
  }
}

query getArtifact($organizationId: ID!, $id: ID!) {
  artifact(organizationId: $organizationId, id: $id) {
    id
    name
    type
    field
    payload
    formats
    createdAt
    updatedAt
    artifactDefinition {
      id
      name
      label
    }
    package {
      id
      slug
    }
    origin
  }
}

mutation deleteArtifact($organizationId: ID!, $id: ID!) {
  deleteArtifact(organizationId: $organizationId, id: $id) {
    successful
    # @genqlient(typename: "MutationValidationError")
    messages {
      message
    }
    result {
      id
      name
    }
  }
}


# ARTIFACT-DEFINITIONS

query getArtifactDefinition($organizationId: ID!, $name: String!) {
  artifactDefinition(organizationId: $organizationId, name: $name) {
    id
    schema
    name
    icon
    label
    updatedAt
    url
    ui {
      connectionOrientation
      environmentDefaultGroup
    }
  }
}

query listArtifactDefinitions($organizationId: ID!) {
  artifactDefinitions(organizationId: $organizationId) {
    id
    schema
    name
    icon
    label
    updatedAt
    url
    ui {
      connectionOrientation
      environmentDefaultGroup
    }
  }
}

query listCredentialArtifactDefinitions($organizationId: ID!) {
  artifactDefinitions(organizationId: $organizationId, input: {filter: {isCredential: true}}) {
    name
  }
}

mutation publishArtifactDefinition($organizationId: ID!, $schema: JSON!) {
  publishArtifactDefinition(organizationId: $organizationId, schema: $schema) {
    result {
      name
      id
    }
    successful
    # @genqlient(typename: "MutationValidationError")
    messages {
      message
    }
  }
}

mutation deleteArtifactDefinition($organizationId: ID!, $name: String!) {
  deleteArtifactDefinition(organizationId: $organizationId, name: $name) {
    successful
    # @genqlient(typename: "MutationValidationError")
    messages {
      message
    }
    result {
      name
      id
    }
  }
}


# BUNDLES

query getBundle($organizationId: ID!, $id: ID!, $version: VersionConstraint) {
  bundle(organizationId: $organizationId, id: $id, version: $version) {
    id
    name
    version
    description
    spec
    specVersion
    icon
    sourceUrl
    paramsSchema
    connectionsSchema
    artifactsSchema
    uiSchema
    operatorGuide
    createdAt
    updatedAt
  }
}


# CONTAINER REPOSITORIES

query containerRepository($orgId: ID!, $artifactId: ID!, $input: ContainerRepositoryInput!) {
  containerRepository(organizationId: $orgId, artifactId: $artifactId, input: $input) {
    token, repoUri
  }
}


# DEPLOYMENTS

query getDeploymentById($organizationId: ID!, $id: ID!) {
  deployment(organizationId: $organizationId, id: $id) {
    id
    status
  }
}

query getDeploymentLogStream($organizationId: ID!, $id: ID!) {
  deploymentLogStream(organizationId: $organizationId, id: $id) {
    id
    logs {
      content
      metadata {
        step
        timestamp
        index
      }
    }
  }
}


# ENVIRONMENTS

query getEnvironmentById($organizationId: ID!, $id: ID!) {
  environment(id: $id, organizationId: $organizationId) {
    id
    name
    slug
    description
    cost {
      monthly {
        average {
          # @genqlient(pointer: true)
          amount
        }
      }
      daily {
        average {
          # @genqlient(pointer: true)
          amount
        }
      }
    }
    packages {
      id
      params
      artifacts {
        id
        name
        field
      }
      remoteReferences {
        artifact {
          id
          name
          field
        }
      }
      bundle {
        id
        name
        spec
        specVersion
      }
      status
      manifest {
        id
        name
        slug
        suffix
        description
      }
    }
    project {
      id
      slug
    }
  }
}

query getEnvironmentsByProject($organizationId: ID!, $projectId: ID!) {
  project(id: $projectId, organizationId: $organizationId) {
    environments {
      id
      name
      slug
      description
      cost {
        monthly {
          average {
            # @genqlient(pointer: true)
            amount
          }
        }
        daily {
          average {
            # @genqlient(pointer: true)
            amount
          }
        }
      }
      packages {
        id
        slug
        status
        params
        artifacts {
          id
          name
          field
        }
        remoteReferences {
          artifact {
            id
            name
            field
          }
        }
        bundle {
          id
          name
          spec
          specVersion
        }
        manifest {
          id
          name
          slug
          suffix
          description
        }
      }
      project {
        id
        slug
      }
    }
  }
}

mutation createEnvironmentConnection($organizationId: ID!, $artifactId: ID!, $environmentId: ID!) {
  createEnvironmentConnection(organizationId: $organizationId, artifactId: $artifactId, environmentId: $environmentId) {
    successful
    messages {
      message
    }
    result {
      id
      artifact {
        id
        name
      }
      environment {
        id
        slug
      }
    }
  }
}

mutation createEnvironment($organizationId: ID!, $projectId: ID!, $name: String!, $slug: String!, $description: String) {
  createEnvironment(organizationId: $organizationId, projectId: $projectId, name: $name, slug: $slug, description: $description) {
    result {
      id
      name
      slug
      description
    }
    successful
    # @genqlient(typename: "MutationValidationError")
    messages {
      message
    }
  }
}


# MANIFESTS

mutation createManifest($organizationId: ID!, $bundleId: ID!, $projectId: ID!, $name: String!, $slug: String!, $description: String) {
  createManifest(organizationId: $organizationId, bundleId: $bundleId, projectId: $projectId, name: $name, slug: $slug, description: $description) {
    result {
      id
      name
      slug
      description
    }
    successful
    # @genqlient(typename: "MutationValidationError")
    messages {
      message
    }
  }
}


# OCI

query getOciRepo($organizationId: ID!, $id: ID!) {
  ociRepo(organizationId: $organizationId, id: $id) {
    name
    releaseChannels {
      name
      tag
    }
    tags {
      tag
    }
  }
}


# PACKAGES

mutation deployPackage($organizationId: ID!, $targetId: ID!, $manifestId: ID!, $message: String!) {
  deployPackage(organizationId: $organizationId, manifestId: $manifestId, targetId: $targetId, message: $message) {
    successful
    result {
      id
    }
    # @genqlient(typename: "MutationValidationError")
    messages {
      message
    }
  }
}

query getPackage($organizationId: ID!, $id: ID!) {
  package(organizationId: $organizationId, id: $id) {
    id
    slug
    status
    params
    artifacts {
      id
      name
      field
    }
    remoteReferences {
      artifact {
        id
        name
        field
      }
    }
    bundle {
      id
      name
      spec
      specVersion
    }
    manifest {
      id
      name
      slug
      suffix
      description
    }
    environment {
      id
      slug
      project {
        id
        slug
      }
    }
  }
}

mutation configurePackage($organizationId: ID!, $id: ID!, $params: JSON!) {
  configurePackage(organizationId: $organizationId, id: $id, params: $params) {
    result {
      id
      params
      slug
    }
    successful
    # @genqlient(typename: "MutationValidationError")
    messages {
      message
    }
  }
}

mutation setPackageVersion($organizationId: ID!, $id: ID!, $version: String!, $releaseStrategy: ReleaseStrategy) {
  setPackageVersion(organizationId: $organizationId, id: $id, version: $version, releaseStrategy: $releaseStrategy) {
    result {
      id
      slug
    }
    successful
    # @genqlient(typename: "MutationValidationError")
    messages {
      message
    }
  }
}

mutation decommissionPackage($organizationId: ID!, $id: ID!, $message: String) {
  decommissionPackage(organizationId: $organizationId, id: $id, message: $message) {
    successful
    result {
      id
    }
    # @genqlient(typename: "MutationValidationError")
    messages {
      message
    }
  }
}

mutation resetPackage($organizationId: ID!, $id: ID!, $deleteState: Boolean!, $deleteParams: Boolean!, $deleteDeployments: Boolean!) {
  resetPackage(organizationId: $organizationId, id: $id, deleteState: $deleteState, deleteParams: $deleteParams, deleteDeployments: $deleteDeployments) {
    successful
    result {
      id
      slug
      status
    }
    # @genqlient(typename: "MutationValidationError")
    messages {
      message
    }
  }
}


# PROJECTS

query getProjects($organizationId: ID!){
  projects(organizationId: $organizationId){
    name
    id
    slug
    description
    defaultParams
    environments{
      name
      slug
    }
    cost{
      monthly{
        average{
          # @genqlient(pointer: true)
          amount
        }
      }
      daily{
        average{
          # @genqlient(pointer: true)
          amount
        }
      }
    }
  }
}

query getProjectById($organizationId: ID!, $id: ID!) {
  project(organizationId: $organizationId, id: $id) {
    id, name, defaultParams, slug, description
  }
}

mutation createProject($organizationId: ID!, $name: String!, $slug: String!, $description: String) {
  createProject(organizationId: $organizationId, name: $name, slug: $slug, description: $description) {
    result {
      id
      name
      slug
      description
    }
    successful
    # @genqlient(typename: "MutationValidationError")
    messages {
      message
    }
  }
}

mutation deleteProject($organizationId: ID!, $id: ID!) {
  deleteProject(organizationId: $organizationId, id: $id) {
    result {
      id
      name
      slug
      description
    }
    successful
    # @genqlient(typename: "MutationValidationError")
    messages {
      message
    }
  }
}


# PREVIEW ENVIRONMENTS

mutation decommissionPreviewEnvironment($orgId: ID!, $targetId: ID!) {
  decommissionPreviewEnvironment(organizationId: $orgId, targetId: $targetId) {
    result {
      id
      slug
      project{
        id
        slug
      }
    }
    successful
    # @genqlient(typename: "MutationValidationError")
    messages {
      message
    }
  }
}

mutation deployPreviewEnvironment($organizationId: ID!, $projectId: ID!, $input: PreviewEnvironmentInput!) {
  deployPreviewEnvironment(projectId: $projectId, organizationId: $organizationId, input: $input) {
    successful
    result {
      id
      slug
      project{
        id
        slug
      }
    }
    # @genqlient(typename: "MutationValidationError")
    messages {
      message
    }
  }
}


# REPOS (BUNDLES)

query listRepos(
  $organizationId: ID!,
  # @genqlient(omitempty: true, pointer: true)
  $sort: ReposSort,
  # @genqlient(omitempty: true, pointer: true)
  $cursor: Cursor,
  # @genqlient(omitempty: true, pointer: true)
  $search: String
) {
  repos(organizationId: $organizationId, sort: $sort, cursor: $cursor, search: $search) {
    cursor {
      next
      previous
    }
    items {
      id
      name
      createdAt
      releaseChannels {
        name
        tag
      }
    }
  }
}


# SERVER

query getServer {
  server {
    appUrl
    mode
    version
  }
}
